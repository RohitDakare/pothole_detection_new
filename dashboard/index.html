<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PotholeIQ â€” Live Detection Dashboard</title>
  <meta name="description" content="Real-time pothole detection map powered by TF-02 Pro LiDAR + YOLO AI on Raspberry Pi 4B" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- â–‘â–‘ SIDEBAR â–‘â–‘ -->
<aside class="sidebar" id="sidebar">

  <!-- Logo -->
  <div class="sidebar-header">
    <div class="logo">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 7h18M3 12h18M3 17h10"/>
          <circle cx="19" cy="17" r="3" fill="#ef4444" stroke="none"/>
        </svg>
      </div>
      <div>
        <span class="logo-title">PotholeIQ</span>
        <span class="logo-sub">Real-Time Detection</span>
      </div>
    </div>
    <button class="sidebar-toggle" id="sidebarToggle" title="Toggle sidebar">â˜°</button>
  </div>

  <!-- Live Stats -->
  <div class="stats-grid">
    <div class="stat-card">
      <span class="stat-num" id="statTotal">0</span>
      <span class="stat-lbl">Total</span>
    </div>
    <div class="stat-card red">
      <span class="stat-num" id="statCritical">0</span>
      <span class="stat-lbl">Critical</span>
    </div>
    <div class="stat-card orange">
      <span class="stat-num" id="statModerate">0</span>
      <span class="stat-lbl">Moderate</span>
    </div>
    <div class="stat-card green">
      <span class="stat-num" id="statRepaired">0</span>
      <span class="stat-lbl">Repaired</span>
    </div>
  </div>

  <!-- AI Model Info -->
  <div class="model-panel">
    <div class="model-header">
      <span class="model-icon">ğŸ¤–</span>
      <span class="model-title">YOLOv8 Online Learning</span>
      <span class="live-dot" id="liveDot"></span>
    </div>
    <div class="model-row">
      <span class="model-key">Model Version</span>
      <span class="model-val mono" id="modelVersion">â€”</span>
    </div>
    <div class="model-row">
      <span class="model-key">YOLO Confirmed</span>
      <span class="model-val" id="modelYoloRate">â€”</span>
    </div>
    <div class="model-row">
      <span class="model-key">Avg Confidence</span>
      <span class="model-val" id="modelAvgConf">â€”</span>
    </div>
    <div class="model-row">
      <span class="model-key">Avg Depth</span>
      <span class="model-val" id="modelAvgDepth">â€”</span>
    </div>
    <div class="model-row">
      <span class="model-key">Max Depth</span>
      <span class="model-val mono" id="modelMaxDepth">â€”</span>
    </div>
  </div>

  <!-- Filter Bar -->
  <div class="filter-bar">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn red" data-filter="Red">ğŸ”´ Critical</button>
    <button class="filter-btn orange" data-filter="Orange">ğŸŸ  Moderate</button>
    <button class="filter-btn green" data-filter="Green">ğŸŸ¢ Repaired</button>
  </div>

  <!-- Pothole List -->
  <div class="pothole-list" id="potholeList">
    <div class="list-empty" id="listEmpty">
      <div class="empty-icon">ğŸ“¡</div>
      <p>Awaiting detectionsâ€¦</p>
      <p class="empty-sub">LiDAR + YOLO active</p>
    </div>
  </div>

  <!-- Connection Status -->
  <div class="conn-bar">
    <span class="conn-dot" id="connDot"></span>
    <span id="connStatus">Connectingâ€¦</span>
    <span class="conn-refresh" onclick="refreshNow()" title="Refresh now">â†»</span>
  </div>

</aside>

<!-- â–‘â–‘ MAIN CONTENT â–‘â–‘ -->
<main class="main-content">

  <!-- Top bar -->
  <div class="topbar">
    <div class="topbar-left">
      <span class="topbar-title">Live Pothole Map</span>
      <span class="topbar-sub" id="lastUpdate">â€”</span>
    </div>
    <div class="topbar-right">
      <div class="search-wrap">
        <input type="text" class="search-input" id="searchInput"
               placeholder="Search ID, severityâ€¦" oninput="applySearch()" />
      </div>
      <a href="/admin" class="btn-outline">Admin â†—</a>
    </div>
  </div>

  <!-- Map -->
  <div id="map"></div>

  <!-- Detail Panel (slides in from right) -->
  <div class="detail-panel" id="detailPanel">
    <div class="detail-header">
      <div>
        <h2 id="detailTitle">Pothole Details</h2>
        <span class="detail-badge" id="detailBadge">â€”</span>
      </div>
      <button class="detail-close" onclick="closeDetail()">âœ•</button>
    </div>

    <div class="detail-body">
      <!-- Depth bar -->
      <div class="depth-bar-wrap">
        <div class="depth-bar-label">
          <span>Depth</span><span id="detailDepthVal">â€”</span>
        </div>
        <div class="depth-bar-track">
          <div class="depth-bar-fill" id="detailDepthBar"></div>
        </div>
      </div>

      <!-- Dimension pills -->
      <div class="dim-grid">
        <div class="dim-pill">
          <span class="dim-val" id="dLength">â€”</span>
          <span class="dim-lbl">Length cm</span>
        </div>
        <div class="dim-pill">
          <span class="dim-val" id="dWidth">â€”</span>
          <span class="dim-lbl">Width cm</span>
        </div>
        <div class="dim-pill">
          <span class="dim-val" id="dVolume">â€”</span>
          <span class="dim-lbl">Volume cmÂ³</span>
        </div>
        <div class="dim-pill">
          <span class="dim-val" id="dSamples">â€”</span>
          <span class="dim-lbl">LiDAR Hits</span>
        </div>
      </div>

      <!-- Meta rows -->
      <div class="meta-list">
        <div class="meta-row">
          <span class="meta-key">ğŸ¤– YOLO</span>
          <span class="meta-val" id="dYolo">â€”</span>
        </div>
        <div class="meta-row">
          <span class="meta-key">ğŸ“ GPS</span>
          <span class="meta-val mono" id="dCoords">â€”</span>
        </div>
        <div class="meta-row">
          <span class="meta-key">â± Detected</span>
          <span class="meta-val" id="dTime">â€”</span>
        </div>
        <div class="meta-row">
          <span class="meta-key">ğŸ· Status</span>
          <span class="meta-val" id="dStatus">â€”</span>
        </div>
        <div class="meta-row">
          <span class="meta-key">ğŸ”¢ Model v</span>
          <span class="meta-val mono" id="dModelVer">â€”</span>
        </div>
      </div>

      <!-- Depth profile sparkline -->
      <div class="sparkline-wrap">
        <span class="sparkline-label">Depth Profile (LiDAR samples)</span>
        <canvas id="sparklineCanvas" width="300" height="60"></canvas>
      </div>

      <!-- Action buttons -->
      <div class="detail-actions">
        <button class="btn-repair" id="btnRepair" onclick="repairCurrent()">
          âœ“ Mark Repaired
        </button>
        <button class="btn-danger" id="btnDelete" onclick="deleteCurrent()">
          ğŸ—‘ Delete
        </button>
      </div>
    </div>
  </div>

</main>

<!-- Scripts -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="app.js"></script>
</body>
</html>
